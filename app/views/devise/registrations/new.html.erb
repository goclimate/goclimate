<div class="site-wrapper-first">
  <%= render "shared/header" %>
  <div class="inner">

    <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
    <h1><%= title(t('where_will_my_money_be_used')) %></h1>
    <p class="lead"><%= description(t('we_invest_in_un_climate_projects_that_are_gold_standard_certified')) %></p>

    <div id="carousel-with-projects" class="carousel slide" data-ride="carousel" data-interval="8000">

      <!-- Indicators -->
      <ol class="carousel-indicators">
        <li data-target="#carousel-with-projects" data-slide-to="0" class="active"></li>
        <li data-target="#carousel-with-projects" data-slide-to="1"></li>
        <li data-target="#carousel-with-projects" data-slide-to="2"></li>
      </ol>

      <!-- Wrapper for slides -->
      <div class="carousel-inner" role="listbox">

        <div class="item active">
          <%= image_tag webpack_asset_path("images/carousel/thai_solar.jpg"), class: "small", alt: "" %>
          <%= image_tag webpack_asset_path("images/carousel/thai_solar_2.jpg"), class: "big", alt: "" %>
          <div class="carousel-caption">
            <h3>Thai Solar</h3>
            <p><%=t 'thai_solar_carousel_description' %></p>
          </div>
        </div>

        <div class="item">
          <%= image_tag webpack_asset_path("images/carousel/nanyang.jpg"), class: "small", alt: "" %>
          <%= image_tag webpack_asset_path("images/carousel/nanyang_2.jpg"), class: "big", alt: "" %>
          <div class="carousel-caption">
            <h3>Nanyang Danjiang River Solar Cooker Project</h3>
            <p><%=t 'nanyang_danjiang_carousel_description' %></p>
          </div>
        </div>

        <div class="item">
          <%= image_tag webpack_asset_path("images/carousel/dak_pone.jpg"), class: "small", alt: "" %>
          <%= image_tag webpack_asset_path("images/carousel/dak_pone_2.jpg"), class: "big", alt: "" %>
          <div class="carousel-caption">
            <h3>Dak Pone Hydro Power</h3>
            <p><%=t 'dak_pone_carousel_description' %></p>
          </div>
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#carousel-with-projects" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#carousel-with-projects" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>

  </div>
  <a id="scroll-to-second-section"><span class="glyphicon glyphicon-chevron-down glyphicon-plan-first" aria-hidden="true"></span></a>
</div>

<div id="second-section" class="site-wrapper-second">
  <div class="inner">

    <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
    <h1 class="cover-heading"><%=t 'good_to_know' %></h1>

    <div class="trust">
      <ul class="trust lead">
        <li><%=t 'why_trust_1' %></li>
        <li><%=t 'why_trust_2' %></li>
        <li><%=t 'why_trust_4' %></li>
        <li><%=t 'why_trust_5' %></li>
      </ul>
    </div>

  </div>
  <a id="scroll-to-third-section"><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></a>
</div>

<div id="third-section" class="site-wrapper-third">
  <div class="inner">

    <h1 class="cover-heading"><%=t 'sign_up_for_a_climate_neutral_life' %></h1>
    <p class="lead"><%=t 'you_will_offset_for', cost: @current_plan_price.to_s(precision: :auto) %>. <%=t 'sign_up_here_to_start_livint_a_climate_neutral_life' %></p>
    <span class="glyphicon glyphicon-hand-down" aria-hidden="true"></span>

    <div id="error_explanation">
      <% if flash[:error].present? || resource.errors.any? || @manager&.errors.present? %>
        <% if flash[:error].present? %>
          <p><%= flash[:error] %></p>
        <% end %>
        <% if resource.errors.any? %>
          <% resource.errors.values.flatten.each do |message| %>
            <p><%= message %></p>
          <% end %>
        <% end %>
        <% if @manager.present? && @manager.errors.any? %>
          <p>The payment failed: <%= @manager.errors.values.join(' ') %></p>
        <% end %>
      <% end %>
      <p id="error-content"></p>
    </div>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: {id: "payment-form", :class => "form-horizontal"}) do |f| %>
      <%# TODO: Use nested form helpers with a generic form_for and a fields_for resource so that choices params can live outside of the user hash and be consistent across new and create actions %>
      <%= hidden_field(:user, :choices, :value => @choices) %>

      <div class="form-group">
        <label for="email" class="col-sm-offset-1 col-sm-4 control-label"><%=t 'email' %></label>
        <div class="col-sm-4">
          <%= f.email_field :email, required: true, id: "email", class: "form-control" %>
        </div>
      </div>

      <div class="form-group">
        <label for="password" class="col-sm-offset-1 col-sm-4 control-label"><%=t 'password' %></label>
        <div class="col-sm-4">
          <%= f.password_field :password, required: true, minlength: '6', maxlength: '128', autocomplete: "off", id: "password", class: "form-control" %>
        </div>
      </div>

      <%= hidden_field(:manager, :customer_id) %>
      <%= hidden_field(:manager, :payment_intent_client_secret) %>

      <div class="form-group">
        <label for="card-element" class="col-sm-offset-1 col-sm-4 control-label"><%=t 'credit_or_debit_card' %></label>
        <div class="col-sm-4">
          <div id="card-element" class="form-control">
            <!-- a Stripe Element will be inserted here. -->
          </div>
          <span class="glyphicon glyphicon glyphicon-lock secured-by-stripe" aria-hidden="true"></span>Secured by Stripe
        </div>
      </div>

      <div id="card-errors"></div>

      <div class="form-group form-group-sm-centered">
        <div class="col-sm-offset-5 col-sm-7">
          <div class="checkbox">
            <label>
              <%= f.check_box :privacy_policy %>
              <span>
                <%=t 'i_accept' %>
                <%= link_to I18n.t('our_privacy_policy'), privacy_policy_path, target: '_blank', class: 'privacy-policy-link' %>
              </span>
            </label>
          </div>
        </div>
      </div>

      <div class="form-group form-group-sm-centered">
        <div class="col-sm-offset-5 col-sm-3">
          <button id="register-button" type="submit" class="btn btn-success">
            <i class="fa fa-spinner fa-spin hidden" id="button-spinner"></i>
            <%=t 'go_climate_neutral' %>
          </button>
        </div>
      </div>
    <% end %>

    <p class="last plan-faq"><a href="/faq"><%=t 'faq_questions.questions.q18.question' %> <%=t 'faq_questions.questions.q19.question' %> <%=t 'faq_questions.questions.q20.question' %> <%=t 'read_more_on_frequently_asked_questions' %></a>.</p>
  </div>
</div>

<% content_for :javascript_tags do %>
  <script type="text/javascript">
    var STRIPE_PUBLISHABLE_KEY = "<%= ENV['PUBLISHABLE_KEY'] %>"

    $(document).ready(function() {
      initializeUsersRegistrations();
    });
  </script>
<% end %>
